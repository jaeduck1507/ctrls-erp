<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.erp.fm.mapper.BudgetMapper">
	
	<resultMap id="BudgetDeptMap" type="BudgetDeptDTO">
		<id property="budgetNo" column="budget_no"/>
		<result property="periodType" column="period_type"/>
		<result property="periodValue" column="period_value"/>
		<result property="annualBudget" column="annual_budget"/>
		<result property="plan" column="plan"/>
		<result property="executionDate" column="execution_date"/>
		<result property="deptName" column="dept_name"/>
	</resultMap>
	
	<select id="showBudget" parameterType="BudgetDeptDTO" resultMap="BudgetDeptMap">
		SELECT budget_no, period_type, period_value, annual_budget, plan, dept_name
		FROM budget
		JOIN department USING(dept_no)
		<where>
			<if test="deptName != 'dept'">
				dept_name = #{deptName}
			</if>
		</where>
	</select>
	
	<insert id="budgetRegister" parameterType="ArrayList">
		INSERT INTO budget(period_type, annual_budget, plan, execution_date, dept_no) VALUES
		<foreach collection="bList" item="budget" separator=",">
		(#{budget.periodType},#{budget.annualBudget},#{budget.plan},#{budget.executionDate},#{budget.deptNo})
		</foreach>
	</insert>
	
	<update id="updatePV" parameterType="Budget">
		UPDATE budget SET period_value = CONCAT(YEAR(execution_date), '-', period_type, budget_no)
	</update>
	
</mapper>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.erp.fm.mapper.PurchaseMapper">
	
	<resultMap id="PurDeptMap" type="PurDeptDTO">
		<id property="purchaseNo" column="purchase_no"/>
		<result property="unitPrice" column="unit_price"/>
		<result property="quantity" column="quantity"/>
		<result property="varAmount" column="var_amount"/>
		<result property="totalAmount" column="total_amount"/>
		<result property="purchaseDate" column="purchase_date"/>
		<result property="productName" column="product_name"/>
		<result property="productCategory" column="product_category"/>
		<result property="brandCode" column="brand_code"/>
		<result property="brandName" column="brand_name"/>
		<result property="totalPurchase" column="total_purchase"/>
	</resultMap>
	
	<select id="showPurchase" parameterType="PurDeptDTO" resultMap="PurDeptMap">
		SELECT purchase_no, product_name, product_category,  unit_price, quantity, var_amount, total_amount, purchase_date, brand_name
		FROM purchase
		JOIN brand USING(brand_code)
		JOIN product_name USING(product_code)
		<where>
			<if test="startDate != null and endDate != null">
				purchase_date BETWEEN #{startDate} AND #{endDate}
			</if>
			<if test="productCategory != 'all'">
				AND product_category = #{productCategory}
			</if>
			<if test="productName != null">
				AND product_name LIKE CONCAT ('%', #{productName}, '%')
			</if>
		</where>
	</select>
	
	<insert id="purchaseRegister" parameterType="ArrayList">
		INSERT INTO purchase (unit_price, quantity, var_amount, total_amount, purchase_date, product_code, brand_code) VALUES
		<foreach collection="prList" item="purchase" separator=",">
		(#{purchase.unitPrice},#{purchase.quantity},#{purchase.varAmount},#{purchase.totalAmount},#{purchase.purchaseDate},#{purchase.productCode},#{purchase.brandCode})
		
		</foreach>
	</insert>
	
	<select id="totalPurchase" parameterType="PurDeptDTO" resultMap="PurDeptMap">
		SELECT brand_code, brand_name, purchase_date, SUM(total_amount) AS total_purchase FROM purchase
		JOIN brand USING(brand_code)
		WHERE brand_code = #{brandCode}
		AND purchase_date = #{purchaseDate}
		GROUP BY brand_code, brand_name, purchase_date
	</select>
</mapper>
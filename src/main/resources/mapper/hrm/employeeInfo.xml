<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.erp.hrm.mapper.EmployeeInfoMapper">
<resultMap type="EmpInfo" id="EmpInfoMap">
	<result column="emp_no" property="empNo"/>
	<result column="emp_name" property="empName"/>
	<result column="job_title" property="jobTitle"/>
	<result column="dept_name" property="deptName"/>
</resultMap>
	<select id="infoShow" parameterType="EmpInfo" resultMap="EmpInfoMap">
		SELECT emp_no,emp_name, dept_name, job_title 
		FROM employee_info
		JOIN department USING(dept_no)
		JOIN job_position USING(job_no)
		<where>
		<if test="empName != null" >
			emp_name LIKE CONCAT('%', #{empName}, '%')
		</if>
		<if test='jobNo != -1'>
			AND job_no = #{jobNo}
		</if>
		<if test='deptNo != -1'>
			AND dept_no = #{deptNo}
		</if>
		</where>
		
	</select>
	
<!-- 윤의진 추가 qc 위함 -->
	<select id="showEmployee" resultMap="EmpInfoMap"> 
		SELECT emp_no,emp_name, dept_name, job_title 
		FROM employee_info
		JOIN department USING(dept_no)
		JOIN job_position USING(job_no)
	</select>
	
	<insert id="empAdd" parameterType="ArrayList">
		INSERT INTO employee_info (emp_id, emp_in, emp_pwd, emp_name, job_no, dept_no, hire_date, salary, addr, phone, email) VALUES
		<foreach collection="eiList" item="emp" separator=",">
		(#{emp.empId},#{emp.empIn},#{emp.empPwd},#{emp.empName},#{emp.jobNo},#{emp.deptNo},#{emp.hireDate},#{emp.salary},#{emp.addr},#{emp.phone},#{emp.email})
		
		</foreach>
	</insert>
	
	<select id="totalEmp" parameterType="EmpInfo" resultType="int">
		SELECT count(*) 
		FROM employee_info
		JOIN department USING(dept_no)
		JOIN job_position USING(job_no)
		<where>
		<if test="empName != null" >
			emp_name LIKE CONCAT('%', #{empName}, '%')
		</if>
		<if test='jobNo != -1 and jobTitle != null'>
			AND job_no = #{jobNo}
		</if>
		<if test='deptNo != -1 and deptNo != null'>
			AND dept_no = #{deptNo}
		</if>
		</where>
		
	</select>
	
	<select id="infoShowPage" parameterType="EmpInfoPagingDTO" resultMap="EmpInfoMap">
		SELECT emp_no,emp_name, dept_name, job_title 
		FROM employee_info
		JOIN department USING(dept_no)
		JOIN job_position USING(job_no)
		<where>
		<if test="empInfo.empName != null" >
			emp_name LIKE CONCAT('%', #{empInfo.empName}, '%')
		</if>
		<if test='empInfo.jobNo != -1'>
			AND job_no = #{empInfo.jobNo}
		</if>
		<if test='empInfo.deptNo != -1'>
			AND dept_no = #{empInfo.deptNo}
		</if>
		</where>
		LIMIT #{hrmPagingDTO.offset}, #{hrmPagingDTO.limit}
	</select>
</mapper>
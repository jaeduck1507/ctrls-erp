<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.erp.hrm.mapper.PerformanceReviewMapper">

	<resultMap id="EmpInfoMap" type="EmpInfo">
	    <id property="empNo" column="emp_no" />
	    <result property="empName" column="emp_name" />
	    <result property="empId" column="emp_id" />
	    <result property="empIn" column="emp_in" />
	    <result property="deptNo" column="dept_no" />
	    <result property="jobNo" column="job_no" />
	    <result property="jobTitle" column="job_title" />
	    <result property="deptName" column="dept_name" />
	    <result property="hireDate" column="hire_date" />
	    <result property="quitDate" column="quit_date" />
	    <result property="salary" column="salary" />
	    <result property="addr" column="addr" />
	    <result property="phone" column="phone" />
	    <result property="email" column="email" />
	</resultMap>
	
	<resultMap id="PerformanceReviewDTOMap" type="PerformanceReviewDTO">
	    <id property="reviewId" column="review_id" />
	    <result property="empNo" column="emp_no" />
	    <result property="evaluatorEmpNo" column="evaluator_emp_no" />
	    <result property="reviewDate" column="review_date" />
	    <result property="attitudeScore" column="attitude_score" />
	    <result property="achieveScore" column="achieve_score" />
	    <result property="avgAttitudeScore" column="avg_attitude_score" />
	    <result property="avgAchieveScore" column="avg_achieve_score" />
	    <result property="comments" column="comments" />
	    <result property="deptNo" column="dept_no" />
	</resultMap>
	
	<insert id="empEval" parameterType="PerformanceReview">
		INSERT INTO performance_review(emp_no,evaluator_emp_no,attitude_score,achieve_score,comments)
		VALUES(#{empNo},#{evaluatorEmpNo},#{attitudeScore},#{achieveScore},#{comments})
	</insert>
	
	<select id="showEvalEmp" parameterType="EmpInfo" resultMap="EmpInfoMap">
		select evaluator_emp_no as 'emp_no'
		from performance_review 
		WHERE emp_no = #{empNo}
		AND review_date LIKE CONCAT('%', #{year}, '%')
		
	</select>
	
	<select id="showEval" parameterType="PerformanceReviewDTO" resultMap="PerformanceReviewDTOMap">
		select evaluator_emp_no ,avg(attitude_score) as avg_attitude_score, avg(achieve_score) as avg_achieve_score
		from performance_review
		where evaluator_emp_no = #{empNo}
		AND review_date LIKE CONCAT('%', #{year}, '%')
		group by evaluator_emp_no
	</select>
	
	<select id="showCommnetsList" parameterType="PerformanceReviewDTO" resultMap="PerformanceReviewDTOMap">
		select comments
		from performance_review
		where evaluator_emp_no = #{empNo}
		AND review_date LIKE CONCAT('%', #{year}, '%')
		AND trim(comments) != ''
		AND comments IS NOT NULL
	</select>
</mapper>
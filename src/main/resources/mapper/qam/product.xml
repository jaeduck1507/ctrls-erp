<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.erp.qam.mapper.ProductMapper">
    <!-- âœ… DTO ë§¤í•‘ ì„¤ì •: SQL ê²°ê³¼ ì»¬ëŸ¼ â†’ ProductDetailDTO í•„ë“œë¡œ ë§¤í•‘ -->
    <resultMap type="ProductDetailDTO" id="ProductDetailMap">
        <result column="product_no" property="productNo"/>
        <result column="production_date" property="productionDate"/>
        <result column="product_code" property="productCode"/>
        
        <result column="product_color" property="productColor"/>
        <result column="product_name" property="productName"/>
        <result column="product_price" property="productPrice"/>
        <result column="product_cost" property="productCost"/>
        <result column="product_category" property="productCategory"/>
    </resultMap>

    <!-- âœ… ì „ì²´ ì œí’ˆ ëª©ë¡ ì¡°íšŒ (ì¡°ì¸) -->
    <select id="showProductDetail" resultMap="ProductDetailMap">
        SELECT p.product_no, p.production_date, p.product_code,
               pn.product_color, pn.product_name, pn.product_price,
               pn.product_cost, pn.product_category
        FROM product p
        JOIN product_name pn ON p.product_code = pn.product_code
    </select>

    <!-- âœ… ë‹¨ì¼ ì œí’ˆ ìƒì„¸ ì¡°íšŒ (ìˆ˜ì • í¼ ì§„ìž… ì‹œ ì‚¬ìš©) -->
    <select id="findProductDetailById" parameterType="int" resultMap="ProductDetailMap">
        SELECT p.product_no, p.production_date, p.product_code,
               pn.product_color, pn.product_name, pn.product_price,
               pn.product_cost, pn.product_category
        FROM product p
        JOIN product_name pn ON p.product_code = pn.product_code
        WHERE p.product_no = #{productNo}
    </select>

    <!-- âœ… ì œí’ˆëª… ì •ë³´ ì—…ë°ì´íŠ¸ (product_name í…Œì´ë¸” ìˆ˜ì •) -->
    <update id="updateProductNameFromDetail" parameterType="ProductDetailDTO">
        UPDATE product_name
        SET product_color = #{productColor},
            product_name = #{productName},
            product_price = #{productPrice},
            product_cost = #{productCost},
            product_category = #{productCategory}
        WHERE product_code = #{productCode}
    </update>

    <!-- âœ… ì œí’ˆ ì •ë³´ ì—…ë°ì´íŠ¸ (product í…Œì´ë¸” ìˆ˜ì •) -->
    <update id="updateProductFromDetail" parameterType="ProductDetailDTO">
        UPDATE product
        SET production_date = #{productionDate}
        WHERE product_no = #{productNo}
    </update>

    <!-- âœ… ì œí’ˆ ì‚­ì œ (product í…Œì´ë¸”ì—ì„œ ì‚­ì œ) -->
    <delete id="deleteProduct" parameterType="int">
        DELETE FROM product WHERE product_no = #{productNo}
    </delete>

    <!-- âœ… ì œí’ˆ ê²€ìƒ‰ (ë™ì  ì¡°ê±´: ì´ë¦„, ì¹´í…Œê³ ë¦¬) -->
    <select id="searchProductDetail" resultMap="ProductDetailMap">
        SELECT p.product_no, p.production_date, p.product_code,
               pn.product_color, pn.product_name, pn.product_price,
               pn.product_cost, pn.product_category
        FROM product p
        JOIN product_name pn ON p.product_code = pn.product_code
        WHERE 1=1
        <!-- ðŸ” ì œí’ˆëª… LIKE ê²€ìƒ‰ -->
        <if test="productName != null and productName != ''">
            AND pn.product_name LIKE CONCAT('%', #{productName}, '%')
        </if>
        <!-- ðŸ” ì¹´í…Œê³ ë¦¬ ì •í™• ì¼ì¹˜ ê²€ìƒ‰ -->
        <if test="productCategory != null and productCategory != ''">
            AND pn.product_category = #{productCategory}
        </if>
    </select>

</mapper>
